@inject ShortcutService ShortcutService
@implements IDisposable

<div class="col">
    <button class="btn btn-primary" disabled="@Disabled" @onclick="HandleOnClickAsync">@DisplayName</button>
</div>

@code{

    [Parameter]
    public bool Disabled { get; set; } = true;

    [Parameter]
    public ActionName? ActionName { get; set; }

    [Parameter][EditorRequired]
    public EventCallback<ActionName> OnTriggered { get; set; }

    [Parameter]
    public string? Name { get; set; }

    [Parameter]
    public char? Shortcut { get; set; }

    private ShortcutSubscription? _subscription;

    private string DisplayName => Name ?? ActionName.ToString() ?? "Undefined";

    protected override void OnInitialized()
    {
        var sc = Shortcut ?? DisplayName.FirstOrDefault();
        _subscription = ShortcutService.RegisterShortcut(sc, HandleOnClickAsync);
    }

    private Task HandleOnClickAsync()
    {
        if (Disabled) return Task.CompletedTask;
        return ActionName == null ? OnTriggered.InvokeAsync() : OnTriggered.InvokeAsync(ActionName.Value);
    }

    public void Dispose()
    {
        _subscription?.Dispose();
        _subscription = null;
    }

}